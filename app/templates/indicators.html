{% set page_title = "Indicators time-series" %}
<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ page_title }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Chart.js + time adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.5.0/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>

  <style>
    body { background:#0b0d12; color:#e6e9ef; }
    .card { background:#121622; border:1px solid #23283b; }
    .indicator-grid { max-height:45vh; overflow:auto; border:1px dashed #30364d; padding:.5rem; border-radius:.75rem; }
    .sticky-actions { position:sticky; bottom:0; background:rgba(11,13,18,.9); padding-top:.75rem; }
    .spinner { display:none; }
    .dim { opacity:.6; }
    canvas { max-height:78vh; }
    .badge-ind { background:#1f2436; border:1px solid #30364d; }
    .form-check-label {
      color: #dce3f0;           /* світліший текст */
      font-weight: 500;         /* трохи жирніший */
    }
    .form-check-input:checked {
      background-color: #3b82f6;   /* яскраво-синій */
      border-color: #3b82f6;
    }
  </style>
</head>
<body>
<div class="container-fluid py-3">
  <div class="row g-3">
    <!-- Фільтри -->
    <div class="col-12 col-lg-3">
      <div class="card h-100">
        <div class="card-body pb-0">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h5 class="card-title m-0">Фільтри</h5>
            <button id="btnReset" class="btn btn-outline-secondary btn-sm">Скинути</button>
          </div>

          <form id="filtersForm" class="row g-2">
            <div class="col-6">
              <label class="form-label">User ID</label>
              <input type="number" class="form-control form-control-sm" name="user_id" placeholder="46205214">
            </div>
            <div class="col-6">
              <label class="form-label">Exchange</label>
              <input type="text" class="form-control form-control-sm" name="exchange" placeholder="binance">
            </div>
            <div class="col-6">
              <label class="form-label">Pair</label>
              <input type="text" class="form-control form-control-sm" name="pair" placeholder="BTCUSDT">
            </div>
            <div class="col-6">
              <label class="form-label">Timeframe</label>
              <select class="form-select form-select-sm" name="timeframe">
                <option value="">—</option>
                <option>1m</option><option>5m</option><option>15m</option>
                <option>1h</option><option>4h</option><option>12h</option><option>1d</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label">BB period</label>
              <input type="number" class="form-control form-control-sm" name="bb_period" placeholder="20">
            </div>
            <div class="col-6">
              <label class="form-label">RSI period</label>
              <input type="number" class="form-control form-control-sm" name="rsi_period" placeholder="14">
            </div>
            <div class="col-6">
              <label class="form-label">Від</label>
              <input type="datetime-local" class="form-control form-control-sm" name="from">
            </div>
            <div class="col-6">
              <label class="form-label">До</label>
              <input type="datetime-local" class="form-control form-control-sm" name="to">
            </div>

            <div class="col-12">
              <label class="form-label">Період (швидкий вибір)</label>
              <div class="hstack gap-2 flex-wrap">
                <button type="button" class="btn btn-sm btn-outline-light dim" data-range="1d">1d</button>
                <button type="button" class="btn btn-sm btn-outline-light dim" data-range="3d">3d</button>
                <button type="button" class="btn btn-sm btn-outline-light dim" data-range="7d">7d</button>
                <button type="button" class="btn btn-sm btn-outline-light dim" data-range="14d">14d</button>
                <button type="button" class="btn btn-sm btn-outline-light dim" data-range="30d">30d</button>
              </div>
            </div>

            <div class="col-12 mt-2">
              <div class="d-flex align-items-center justify-content-between mb-1">
                <h6 class="m-0">Індикатори</h6>
                <div class="btn-group btn-group-sm" role="group">
                  <button type="button" id="checkAll" class="btn btn-outline-secondary">Всі</button>
                  <button type="button" id="uncheckAll" class="btn btn-outline-secondary">Жоден</button>
                </div>
              </div>
              <div id="indicatorsCheckboxes" class="indicator-grid"></div>
              <div class="small text-secondary mt-2">Подвійний клік по чеку → серія на праву вісь Y</div>
            </div>

            <div class="col-12 sticky-actions">
              <div class="d-flex gap-2">
                <button id="btnLoad" class="btn btn-primary flex-grow-1" type="submit">Побудувати</button>
                <button id="btnExport" class="btn btn-outline-info" type="button">CSV</button>
              </div>
              <div class="spinner text-center mt-2" id="spinner">
                <div class="spinner-border spinner-border-sm text-light" role="status"></div>
                <span class="ms-2 small">Завантаження…</span>
              </div>
              <div class="text-danger small mt-2" id="errorBox" style="display:none"></div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Графік -->
    <div class="col-12 col-lg-9">
      <div class="card">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <h5 class="card-title m-0">Графік індикаторів</h5>
            <div id="activeIndicators" class="d-flex flex-wrap gap-1"></div>
          </div>
          <canvas id="chartCanvas"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', path='/js/indicators.js') }}"></script>
</body>
</html>
